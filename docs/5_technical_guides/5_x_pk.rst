.. book pi_exhibits_STIX.md

The Pollaczeck-Khinchine Formula
=========================================

**Objectives:** Illustrate and compute Pollaczeck-Khinchine formula for probability of eventual ruin for a compound Poisson process.

**Audience:** Advanced users.

**Prerequisites:** Advanced risk theory.


**Contents:**

* :ref:`pz hr`
* :ref:`pz intro`
* :ref:`pz fft`
* :ref:`pz using`
* :ref:`pz scale`

.. _pz hr:

Helpful References
--------------------

* :cite:t:`Embrechts1997` Section 1.2
* :cite:t:`PIR` sections 8.4.2 and 9.3 and references therein (largely reproduced here).

.. _pz intro:

Classical Risk Theory and the Pollaczeck-Khinchine Formula
-----------------------------------------------------------

.. straight out of the book

The Pollaczeck-Khinchine formula determines the probability of eventual
ruin in a portfolio where claims are driven by a compound Poisson
process, in terms of starting surplus and the premium rate. Losses
are generated by a Poisson process with :math:`\lambda` annual expected
claims and iid severity :math:`X`. Losses up to time :math:`t` are given
by

.. math::


   A(t) = X_1 + \cdots + X_{N(t)},

where :math:`N(t)` is Poisson with mean :math:`\lambda t`. Expected loss
per year equals :math:`\lambda\mathsf{E}[X]`. Premium per year equals
:math:`(1+r)\lambda \mathsf{E}[X]` where :math:`r` is the ratio of profit to
expected loss. The corresponding expected loss ratio is :math:`1/(1+r)`.
If :math:`r\le 0` then eventual ruin is certain, so assume :math:`r>0`.

Define the **integrated severity distribution** by

.. math::


   F_I(x)
   &=\frac{1}{\mathsf{E}[X]}\int_0^x S(t)dt \\
   &= \frac{\mathsf{LEV}(x)}{\mathsf E[X]} \\
   &= 1 -\frac{\mathsf{E}[(X-x)^+]}{\mathsf{E}[X]}

where :math:`S` is the survival function of :math:`X`. :math:`F_I` is a
thicker tailed distribution than :math:`F`. Let

.. math::


   U_{u,r}(t) = u + (1+r)\lambda\mathsf{E}[X]t - A(t)

denote accumulated surplus to time :math:`t` given starting surplus
:math:`u`. :math:`U` is called the **surplus process**. Finally, let

.. math::

    \psi(u, r) = \Pr(U_{u,r}(t) < 0\ \text{for some}\ t\ge 0)

be the probability of eventual ruin.

The **Pollaczeck-Khinchine formula** says that

.. math::
    \psi(u, r) = 1 - \frac{r}{1+r}\sum_{n\ge 0} (1+r)^{-n}F_I^{n*}(u)

where :math:`F_I^{n*}` is distribution of the sum of
:math:`n` independent variables with distribution :math:`F_I`. Note that

.. math::

   G(z) = \frac{r}{1+r}\sum_{n\ge 0} \frac{z^n}{(1+r)^n} = \frac{r}{1+r-z}

is the probability generating function of a geometric distribution
:math:`M` with mean :math:`1/r` and
:math:`\Pr(M=m)=\frac{r}{1+r}\frac{1}{(1+r)^m}`. Therefore
:math:`\psi(u)=\Pr(Y > u)` where :math:`Y` is an aggregate distribution
with frequency :math:`M` and severity :math:`F_I`. A surprising
consequence is that the probability of eventual ruin starting with no
surplus, :math:`\psi(0)=1-\Pr(Y=0)=1-\Pr(M=0)=\frac{1}{1+r}` equals the
expected loss ratio!

:cite:t:`Embrechts1997` Section 1.2 shows how
to derive the Pollaczeck-Khinchine formula. The key step is to determine
the distribution of :math:`X-(1+r)T` where :math:`T` is the exponential
waiting time between claims, and to observe that ruin can occur only at
the moment of a claim.

The Pollaczeck-Khinchine formula gives combinations of :math:`u` and
:math:`r` that are consistent with a top-down stability requirement
expressed as a target probability of eventual ruin. Overlaying a cost of
capital provides a link between :math:`r` and :math:`u` that determines
a minimum viable market size. An example of this method is given below.

Because **eventual** is the same in days, weeks or years,
:math:`\psi_{X, m}(u)` is independent of the expected claim count
:math:`\lambda`. In unit of time :math:`1/\lambda` all portfolios have
an expected claim count of one. Therefore :math:`\psi^{-1}(p)` gives a
capital requirement (risk measure) that is a function of severity and
not frequency, i.e., it is independent of portfolio size. Unlike most
risk measures, it does not regard small portfolios as more risky than
large ones.

The **Cramer-Lundberg formula** is an approximation to :math:`\psi` that
applies for thin tailed severities. It says that

.. math::


   \psi(u, r) \le e^{-ku}

where :math:`k>0` is a constant called the **adjustment coefficient**
solving

.. math::


   e^{kP} = \mathsf{E}[e^{kA(1)}]

where :math:`P=(1+r)\lambda\mathsf{E}[X]` is the premium. Given a top-down
stability requirement, we can work backwards from the Cramer-Lundberg
formula to determine a premium.

**Exercise.** Show that if :math:`k=-\log(p)/u`
and premium

.. math::
    P=\frac{1}{k}\log\mathsf{E}[e^{kA(1)}],

then the Cramer-Lundberg formula ensures the probability of eventual ruin
is :math:`\le p`. The properties of :math:`P`  motivate the exponential
premium. In turn, the approximation
:math:`P\approx \mathsf{E}[A(1)] + k\mathsf{Var}(A(1))/2` motivates the variance
principle.

Both the Cramer-Lundberg and Pollaczeck-Khinchine formulas assume
independent and identically distributed severity and Poisson frequency.
These can be reasonable assumptions for the loss process of a small
portfolio. The case of a mixed Poisson can be decomposed as a mixture of
pure Poisson processes.

.. _pz fft:

FFT Computation
-----------------

The distribution of :math:`Y` can be computed using Fast Fourier transforms in
the same way as any aggregate distribution. Some care is needed when the
margin is very small because the claim count is very large.
:class:`Aggregate` includes :meth:`pollaczeck_khinchine` to determine the
integrated distribution :math:`F_I` and convolve it with a geometric
frequency.

.. _pz using:

Using The Pollaczeck-Khinchine Formula
----------------------------------------

This section illustrates the theory using a lognormal severity with a mean of 50,000
and a CV of 10 (:math:`\sigma=2.15`) corresponding to a moderately risky
liability line. It compares starting surplus levels for different
eventual ruin probabilities assuming a margin :math:`r=0.1` with a 1
million and 10 million occurrence limit. It also illustrates
simulations of the surplus process in each case with starting surplus
calibrated to a 0.05 probability of eventual ruin.


Set up the portfolio.

.. ipython:: python
    :okwarning:

    from aggregate import build, qd
    port = build('port PZTest '
                     'agg Limit1  '
                        '0.1 claims '
                        '1000000 xs 0 '
                        'sev lognorm 50000 cv 10 '
                        'poisson'
                     'agg Limit10 '
                        '0.1 claims '
                        ' 10000000 xs 0 '
                        'sev lognorm 50000 cv 10 '
                        'poisson'
                , bs=500, log2=18, padding=1)
    qd(port)


The left plots show the Pollaczeck-Khinchine formula starting surplus as a
function of the eventual ruin probability with margin 0.1 on linear
(solid) and log (dashed) scales. The Cramer-Lundberg formula says that the
probability of eventual ruin is approximately exponential, which is a
straight line on a log scale.

The right column show 500 simulated surplus paths, with :math:`\times`
indicating ruin scenarios. Capital calibrated to 0.05 eventual ruin
probability. Time and volume are symmetric in the model, so volume can be
regarded as time for a fixed size portfolio or a varying sized portfolio for
a fixed time or a combination. Scale indicates cumulative exposure-years.

.. ipython:: python
    :okwarning:

    from aggregate.extensions.pir_figures import fig_9_1
    @savefig pz.png scale=20
    fig_9_1(port)

The right hand plots are computed here with only 100 samples, vs. 500 used in the book, and so the approximation is not as accurate.

These simulations show that the probability of eventual ruin is constrained by
the buildup of surplus in most scenarios. Defaults occur early in the
simulated history. This model could be appropriate for a mutual
companyâ€”indeed some mutual companies have accumulated substantial amounts of
capital. For a stock company, a more realistic approach adds dividends to
manage capital.

.. _pz scale:

Market Scale and Viability
----------------------------

Given severity :math:`X` and ratio :math:`r` of margin to expected loss,
the Pollaczeck-Khinchine function :math:`\psi` is monotone and hence
invertible, allowing us to find :math:`u_{X,r}(p)=\psi_{X,r}^{-1}(p)`,
the starting capital necessary to guarantee probability :math:`p` of
eventual ruin.

The amount of margin equals :math:`r\lambda\mathsf{E}[X]`, where
:math:`\lambda` is the annual expected claim count. Since the expected
margin must pay the cost of capital, we get a market viability
constraint

.. math::
    r\lambda\mathsf{E}[X] \ge \iota\, u_{X,r}(p)

where :math:`\iota` is the cost of capital. Each element is influenced by
different factors:

-  the hazard and contract design determines :math:`X`,
-  the insurance product market determines :math:`r`,
-  the capital markets determine :math:`\iota`, and
-  a regulator or rating agency determines (or strongly influences)
   :math:`p`.

There are two ways to apply this formula.

First, consider a diversifying unit, such as motor liability, where
insurers grow by adding new, independent insureds with the same
severity. Here, the formula gives a
**minimum size of market** constraint

.. math::
    \lambda \ge \iota \, \frac{u_{X,r}(p)}{r\mathsf{E}[X]}.

This function of four variables and :math:`\lambda` is:

-  Increasing and linear in :math:`\iota`: the market must be larger
   given more expensive capital.
-  Decreasing in :math:`r`: the market can be smaller with a higher
   margin.
-  Decreasing in :math:`p`: the market must be larger to support a
   stricter capital standard.
-  Independent of expected severity (because :math:`\psi` is homogeneous
   in :math:`\mathsf{E}[X]`) but dependent on the shape of severity (which
   influences :math:`\psi`).

It shows the natural scale using the lognormal example.  Size, measured by
expected annual claim count, is shown for a range of margins, limits,
and stability constraints. If claim frequency is 5%, the table shows
that a market with 1M limits is reasonable for all :math:`p` and
:math:`r`. For example, the strictest stability constraint
:math:`p=0.01` and lowest margin rate :math:`r=0.025` needs 39,814
claims, or about 800,000 policies, to be viable. With a 10M limit and
same :math:`r`, the market size needs to be >100,000 claims, or about 2.5
million policies, which is less achievable. However, if the margin rate
increases to :math:`r=0.1`, the market size reduces to 9,088 claims or
about 180,000 policies.

.. ipython:: python
    :okwarning:

    from aggregate.extensions.pir_figures import natural_scale
    df = natural_scale(port)
    qd(df, float_format=lambda x: f'{x:,.0f}')

Note: these numbers differ slightly from the book because of the update parameters used for ``port``.

Second, consider a non-diversifying unit, writing catastrophe exposed
business, where insurers grow by covering a greater proportion of each
event. Severity becomes market share times an industry severity
:math:`X`, and the number of events is fixed. US hurricane reinsurance
is an example. In this case, viability is independent of market share
and is controlled by whether the inequality has a solution that is
acceptable to both the product market and the capital market. Viability
is harder to achieve

-  with smaller :math:`\lambda`: rare events are more difficult to
   insure,
-  with lower :math:`p`: higher quality insurance is more expensive,
-  with higher :math:`\iota`: more costly capital, and
-  with lower :math:`r` because :math:`u` increases quickly.
